Amazone Credential:
u882515@gmail.com

Shaigan Ip:
51.79.51.181

How to Enable Password Authentication in AWS ec2 Instances:

Step 1:
ssh -i "hnh.pem" ubuntu@ec2-3-139-68-29.us-east-2.compute.amazonaws.com

Step 2:
sudo passwd ubuntu(ubuntu is my username)

Step 3:
sudo vim /etc/ssh/sshd_config

*Find the Line containing 'PasswordAuthentication' parameter and change its value from 'no' to 'yes'

*PasswordAuthentication yes

*If you want to set up 'root' login, find  'PermitRootLogin' parameter and change its value from 'prohibit-password' to 'yes'

*PermitRootLogin yes


Step 4:
service ssh restart

Step 5:
ssh ubuntu@ec2-3-139-68-29.us-east-2.compute.amazonaws.com


Root User:
ssh ubuntu@3.143.108.49

Normal User:
ssh shakeeb@3.143.108.49


Git Installation:
sudo apt install git-all

Docker Installation:

1.sudo apt-get update
2.sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common

3.curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
4.sudo apt-get install docker-ce docker-ce-cli containerd.io
5.apt-cache madison docker-ce
6.sudo apt-get install docker-ce docker-ce-cli containerd.io
7.sudo apt install docker.io
8.sudo apt install docker-compose



After deploying the docker container Ec2 Instance:
Allow the port to edit the security group for Example if your docker container run 8005 so edit edit the security group tcp 8005 


Bind a Domain:


sudo vim /etc/nginx/sites-available/clearpricing.ga
sudo ln -s /etc/nginx/sites-available/clearpricing.ga /etc/nginx/sites-enabled
sudo systemctl restart nginx



Create a Reverse Proxy using Ngnix:

server {
    listen 80;
    server_name www.clearpricing.ga;

    location / {

        proxy_pass http://18.119.12.94:8005;
    }
}
                                                                                                                                        Create a Reverse Proxy using Apache:                                                                    
                                                                                              
<VirtualHost *:80>
 ServerName shaigansehat.com
 ServerAlias www.shaigansehat.com
 ProxyPass / http://51.79.51.181:8000/
</VirtualHost>



Transfer local machine file to remote server:
scp -r ./build/* username@server_ip:/var/www/your_domain/html


How i host react using nginix
----------------------------------
1.first upload your build folder.
2.create a reverse proxy using nginx

vim /etc/nginx/sites-enabled/your_domain
server {
        listen 80;
        listen [::]:80;

        root /hnh/deploy/build;
        index index.html index.htm index.nginx-debian.html;

        server_name clearpricing.ml www.clearpricing.ml;

        location / {
                try_files $uri $uri/ =404;
        }
}


####add htc access 


server {
        listen 80;
        listen [::]:80;
        root /hnh/testing/testbuild/build;
        index index.html index.htm index.nginx-debian.html;

        server_name cynotech.ga www.cynotech.ga;

        location ~* \.(?:manifest|appcache|html?|xml|json)$ {
    expires -1;
    # access_log logs/static.log; # I don't usually include a static log
  }

  location ~* \.(?:css|js)$ {
    try_files $uri =404;
    expires 1y;
    access_log off;
    add_header Cache-Control "public";
  }

  # Any route containing a file extension (e.g. /devicesfile.js)
  location ~ ^.+\..+$ {
    try_files $uri =404;
  }

  # Any route that doesn't have a file extension (e.g. /devices)
  location / {
    try_files $uri $uri/ /index.html;
  }
}


3.systemctl restart nginx
-------------------------------------------

How i ssl your domain:
-------------------------------------------
1.sudo apt install certbot python3-certbot-nginx
2.create a proxy file verify the syntax of your configuration:
    * sudo nginx -t
    
3.Reload Nginx to load the new configuration:
    * sudo systemctl reload nginx
    
4.To additionally let in HTTPS traffic, allow the Nginx Full profile and delete the redundant Nginx HTTP profile allowance:
    *sudo ufw allow 'Nginx Full'
    *sudo ufw delete allow 'Nginx HTTP'
    *sudo ufw status
    
    
5.Obtaining an SSL Certificate:
 *sudo certbot --nginx -d example.com -d www.example.com
 
6.Verifying Certbot Auto-Renewal:
    *sudo systemctl status certbot.timer
    *To test the renewal process, you can do a dry run with certbot:
        *sudo certbot renew --dry-run
-------------------------------------------


How i Excess gunicorn server inside the docker using nginx:
1.sudo vim /etc/nginx/sites-available/ngnixguni
2.  server {
    listen 80;
    server_name techbullet.ga www.techbullet.ga;

    location = /favicon.ico { access_log off; log_not_found off; }
    location /static/ {
        root /hnh/ngnixtest/testing-nginx;
    }

    location /upload/ {
      root /hnh/ngnixtest/testing-nginx;
    }

    location / {
      proxy_pass http://3.143.108.49:8004;
    }
}


3.sudo ln -s /etc/nginx/sites-available/ngnixguni /etc/nginx/sites-enabled/
4.ssl(sudo certbot --nginx -d techbullet.ga -d www.techbullet.ga)
5.systemctl restart nginx






##########################If your root or other user password is not update so try this##################################

chattr -i /etc/gshadow
chattr -i /etc/group
chattr -ai /etc/shadow
chattr -ai /etc/passwd



##################################################Django channels##############################################################
Requirements:

Django==3.2.6
channels
channels_redis
Twisted[tls,http2]

Deployement:
we need a Asynchronous web server for deployment like daphne

docker-compose file:

version: "3.7"
services:
  
  redis:
    restart: always
    image: redis:latest
    ports:
      - "6379:6379"
    volumes:
      - ./redisdata:/data
        proxy_redirect off;
        proxy_pass http://18.119.140.171:8005;
    }
    
    
*reload the ngnix server
*your ssl private key and certification file is present at this location  /etc/letsencrypt/live




#############How i increase the file uploading size in nginx#########################


sudo nano /etc/nginx/nginx.conf
http {
    # [...]
    client_max_body_size 100m;  //add only this line 
    # [...]
}

sudo systemctl restart nginx



######################how to install mysql client ubuntu###########################


1.sudo apt install python3-dev build-essential
2.sudo apt install libssl1.1
3.sudo apt install libssl1.1=1.1.1f-1ubuntu2
4.sudo apt install libssl-dev
5.sudo apt install libmysqlclient-dev
6.pip3 install mysqlclient


####How i use mysql outside the docker container####


docker run -p 3307:3306 --name my-mysql -e MYSQL_ROOT_PASSWORD=root -d mysql/mysql-server:latest
select user,host from mysql.user;
update mysql.user set host='%' where user='root';
flush privileges;
create database clearcost;

*configure phpmyadmin and connect to mysql
    docker run --name dev-phpmyadmin -d --link my-mysql:db -p 7098:80 phpmyadmin/phpmyadmin
      
     DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'clearcost',
        'USER': 'root',
        'PASSWORD': 'root',
        'HOST': '192.168.0.178',
        'PORT': 3307,
        
    }
}



#####################################          Move folder/file from local machine to docker container   ###########################################


docker cp foo.txt container_id:/foo.txt


####################For the created containers use docker update to update restart policy.#######################
docker update --restart=always 0576df221c0b


###Restart container using docker-compose file###################
version: "3.7"
services:
  web:
    build: .
    command: python manage.py runserver 0.0.0.0:8000
    volumes:
      - .:/code
    ports:
      - "8005:8000"
    restart: always

